import{c as fe,a as ye,b as we,u as Se,d as Ce,e as L,f as _,g as ke,R as C,j as a,M as j,h as e,i as I,k as N,l as U,m as H,n as B,V as D,I as $,H as v,T as m,L as ve,o as Re,F as P,A as M,p as Ae,q as ce,r as w,s as Le,t as Me,v as K,w as Pe,x as ze,y as Ee,z as S,B as Q,C as Oe,D as De,E as X,G as Te,J as xe,K as _e,N as je,S as Ie,O as Ne,P as Ue,Q as z,U as G,W as de,X as He,Y as F,Z as he,_ as Be,$ as x,a0 as $e,a1 as Ge,a2 as ue,a3 as ee,a4 as te,a5 as Fe,a6 as We,a7 as Ve,a8 as qe,a9 as E,aa as O,ab as Ye,ac as Je,ad as Ze,ae as Ke,af as Qe,ag as Xe,ah as et,ai as tt,aj as at,ak as nt,al as ot,am as rt,an as st,ao as ae,ap as ne,aq as it,ar as lt,as as ct,at as dt,au as ht}from"./vendor-1b6e2111.js";function Ft(){import.meta.url,import("_").catch(()=>1);async function*i(){}}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(r){if(r.ep)return;r.ep=!0;const o=c(r);fetch(r.href,o)}})();const ut={gallery:{shanghai:{contributors:["3353040"],name:{en:"Shanghai","zh-Hans":"上海","zh-Hant":"上海"},lastUpdateOn:1683810518708}}},me=fe({name:"app",initialState:ut,reducers:{setGallery:(i,n)=>{i.gallery=n.payload}}}),{setGallery:mt}=me.actions,pt=me.reducer,gt=ye(),pe=we({reducer:{app:pt},middleware:i=>i().prepend(gt.middleware)}),bt=()=>Se(),ge=Ce;window.rmgStore=pe;var W=(i=>(i.APP_LOAD="APP_LOAD",i.UPLOAD_TEMPLATES="UPLOAD_TEMPLATES",i))(W||{});const oe="Hi RMP team! I would like to contribute to the gallery with the data below.",re="**Do not edit lines below, they are meant for bots only!!!**";function V(){const{i18n:i}=L();return n=>{var c,t;return(t=(c=i.languages.map(r=>n[r]).find(r=>r!==void 0))!=null?c:n.en)!=null?t:"(Translation Error)"}}const ft="RMP_GALLERY_CHANNEL",yt="OPEN_TEMPLATE",wt=new BroadcastChannel(ft),St=i=>{const{city:n,isOpen:c,onClose:t}=i,r=_(),o=ke(),{t:u}=L(),k=V(),[l,h]=C.useState({name:{en:""},desc:{en:""},reference:"",updateHistory:[]});C.useEffect(()=>{fetch(`resources/metadata/${n}.json`).then(b=>b.json()).then(b=>h({...b,justification:""}))},[n]);const f=()=>{const b=structuredClone(l),A=(({updateHistory:q,...T})=>({...T,justification:""}))(b);r("/new",{state:{metadata:A}})},s=()=>{wt.postMessage({event:yt,data:n}),o({title:u(`Template ${n} imported in Rail Map Painter.`),status:"success",duration:9e3,isClosable:!0}),t()},p=`https://${window.location.hostname}/rmp/s/${n}`,R={title:u("Link copied."),status:"success",duration:9e3,isClosable:!0};return a(j,{isOpen:c,onClose:t,size:"6xl",scrollBehavior:"inside",children:[e(I,{}),a(N,{children:[e(U,{children:u("Details")}),e(H,{}),a(B,{paddingBottom:10,children:[e(D,{children:e("a",{href:`resources/thumbnails/${n}.png`,target:"_blank",rel:"noopener noreferrer",children:e($,{src:`resources/thumbnails/${n}.png`,alt:n,borderRadius:"lg"})})}),e(v,{as:"h5",size:"md",mt:3,mb:2,children:k(l.name)}),e(m,{children:k(l.desc)}),e(v,{as:"h5",size:"sm",mt:3,mb:2,children:u("Update History")}),e(ve,{children:l.updateHistory.map(b=>e(Re,{children:a(P,{flexDirection:"row",alignItems:"center",children:[e(M,{size:"sm",mr:"2",src:`https://avatars.githubusercontent.com/u/${b.id}`,cursor:"pointer",onClick:()=>fetch(`https://api.github.com/user/${b.id}`).then(A=>A.json()).then(A=>window.open(`https://github.com/${A.login}`))}),e(Ae,{mr:"auto",href:`https://github.com/railmapgen/rmp-gallery/issues/${b.issueNumber}`,isExternal:!0,children:b.reason}),e(m,{children:new Date(b.time).toLocaleDateString(void 0,{hour12:!1})})]})},b.issueNumber))})]}),a(ce,{children:[e(w,{"aria-label":"Like",variant:"ghost",icon:e(Le,{}),isDisabled:!0}),e(w,{"aria-label":"Favorite",variant:"ghost",icon:e(Me,{}),isDisabled:!0}),e(K,{label:p,children:e(w,{"aria-label":"Share",variant:"ghost",icon:e(Pe,{}),onClick:()=>{navigator.clipboard.writeText(p),o(R)}})}),e(w,{"aria-label":"Edit",variant:"ghost",icon:e(ze,{}),onClick:f}),e("a",{href:`resources/real_world/${n}.json`,target:"_blank",rel:"noopener noreferrer",children:e(w,{"aria-label":"Download",variant:"ghost",icon:e(Ee,{})})}),S.isStandaloneWindow()?e(K,{label:"You may directly use this template if your are in Rail Map Painter or Rail Map Toolkit",children:e(w,{"aria-label":"Import",variant:"ghost",icon:e(Q,{}),isDisabled:!0})}):e(w,{"aria-label":"Import",variant:"ghost",icon:e(Q,{}),onClick:s})]})]})]})};function Ct(){const i=_(),n=bt(),c=V(),{t}=L(),{gallery:r}=ge(s=>s.app),o=()=>{i("/new",{state:{metadata:{name:{en:""},desc:{en:""},reference:"",justification:""}}}),S.event(W.UPLOAD_TEMPLATES,{})},[u,k]=C.useState("shanghai"),[l,h]=C.useState(!1),f=s=>{h(!0),k(s)};return C.useEffect(()=>{fetch("resources/real_world.json").then(s=>s.json()).then(s=>n(mt(s)))},[]),a(Oe,{isLazy:!0,isFitted:!0,children:[a(De,{children:[e(X,{children:t("gallery.type.realWorld")}),e(X,{isDisabled:!0,children:t("gallery.type.fantasy")})]}),e(Te,{children:a(xe,{children:[a(P,{flexWrap:"wrap",children:[Object.keys(r).map(s=>a(_e,{variant:"elevated",minWidth:"300",m:"2",children:[a(je,{children:[e($,{src:`resources/thumbnails/${s}@300.png`,alt:s,borderRadius:"lg"}),e(Ie,{mt:"6",spacing:"3",children:e(v,{size:"lg",children:c(r[s].name)})})]}),a(Ne,{children:[e(Ue,{max:3,children:r[s].contributors.map(p=>e(M,{src:`https://avatars.githubusercontent.com/u/${p}`},p))}),e(z,{variant:"solid",colorScheme:"blue",ml:"auto",onClick:()=>f(s),children:t("Details")})]})]},s)),e(G,{onClick:o,position:"fixed",bottom:"20px",right:"20px",zIndex:3,children:e(w,{"aria-label":"new",size:"lg",icon:e(de,{}),colorScheme:"blue",variant:"solid"})})]}),e(St,{city:u,isOpen:l,onClose:()=>h(!1)})]})})]})}const kt=i=>new Promise(n=>{const c=new FileReader;c.onloadend=()=>n(c.result),c.readAsText(i)}),se=(i,n,c)=>{if(n!==null){const t=document.createElement("details");return t.setAttribute("repo","rmp-gallery"),t.setAttribute("type",i),Object.entries(c).forEach(([r,o])=>{t.setAttribute(r,o)}),t.textContent=n,t.outerHTML}else return""},vt=(i,n,c)=>{const t=new Blob([c],{type:n});Rt(i,t)},Rt=(i,n)=>{const c=window.URL.createObjectURL(n),t=document.createElement("a");t.href=c,t.download=i,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(c)},At={"& > div:first-of-type":{flex:1}};function ie(i){const{translations:n,onUpdate:c,onLangSwitch:t,onRemove:r}=i,{t:o}=L(),u=V(),k=(h,f)=>[{type:"select",label:o("Language"),value:h,options:Object.entries(x).reduce((s,p)=>({...s,[p[0]]:u(p[1])}),{}),disabledOptions:n.filter(s=>s[0]!==h).map(s=>s[0]),onChange:s=>t(h,s)},{type:"input",label:o("Name"),value:f,onChange:s=>c(h,s),validator:s=>!!s}],l=()=>{const h=Object.keys(x).filter(f=>!n.find(s=>s[0]===f))[0];c(h,"")};return e(He,{direction:"column",children:n.map(([h,f],s,p)=>a(F,{sx:At,children:[e(he,{fields:k(h,f),noLabel:s>0}),s===p.length-1?e(w,{size:"sm",variant:"ghost","aria-label":o("Add a name in another language"),title:o("Add a name in another language"),onClick:l,icon:e(de,{})}):e(G,{minW:8}),p.length>1&&e(w,{size:"sm",variant:"ghost","aria-label":o("Remove this name"),title:o("Remove this name"),onClick:()=>r(h),icon:e(Be,{})})]},s))})}const Lt={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Mt(){var Y,J;const{state:{metadata:i}}=$e(),n=_(),c=ge(d=>d.app.gallery),{t}=L(),r=()=>n("/"),o=C.useRef(null),[u,k]=C.useState(!1),[l,h]=C.useState(i),[f,s]=C.useState(""),p=(J=(Y=l.name.en)==null?void 0:Y.replace(/[^A-Za-z0-9]/g,"").toLowerCase())!=null?J:"",R=[oe,re,se("metadata",JSON.stringify(l,null,4),{}),se("real_world",f,{compress:"zipson",city:p})].join(`

`),b=new URLSearchParams({labels:"resources",title:`Resources: ${p in c?"Update":"New"} template of ${p}`}),A=async d=>{var y;const g=(y=d.target.files)==null?void 0:y[0];if(console.log("handleFileUpload():: received file",g),!!g){if(g.type!=="application/json"){alert("Invalid file type!"),d.target.value="";return}try{const Z=await kt(g);s(qe.stringify(JSON.parse(Z.trim())).trim())}catch(Z){alert("Invalid file!"),d.target.value=""}}},q=async()=>{o!=null&&o.current&&(o.current.select(),await navigator.clipboard.writeText(R)),window.open("https://github.com/railmapgen/rmp-gallery/issues/new?"+b.toString(),"_blank")},T=()=>{vt(`${p}.txt`,"application/json",R);const d=new URLSearchParams({labels:"resources",title:`Resources: ${p in c?"Update":"New"} template of ${p}`,body:[oe,re,""].join(`

`)});window.open("https://github.com/railmapgen/rmp-gallery/issues/new?"+d.toString(),"_blank")},be=[{type:"custom",label:t("Project file"),component:e(Ge,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:A}),minW:250},{type:"input",label:t("Reference link (Official website preferred)"),placeholder:"Enter the link where you get the valid data",value:l.reference,onChange:d=>h({...l,reference:d}),minW:250},{type:"input",label:t("Justification (English only)"),placeholder:"The reason why you make these changes",validator:d=>/^[a-zA-Z0-9. -]+$/.test(d),value:l.justification,onChange:d=>h({...l,justification:d}),minW:250}];return a(ue,{sx:Lt,children:[a(P,{children:[e(he,{fields:be}),e(ee,{label:t("City Name (English required)"),children:e(ie,{translations:Object.entries(l.name),onUpdate:(d,g)=>h({...l,name:{...l.name,[d]:g}}),onLangSwitch:(d,g)=>{const y=structuredClone(l);y.name[g]=y.name[d],delete y.name[d],h(y)},onRemove:d=>{const g=structuredClone(l);delete g.name[d],h(g)}})}),e(ee,{label:t("Description (Optional, English required)"),children:e(ie,{translations:Object.entries(l.desc),onUpdate:(d,g)=>h({...l,desc:{...l.desc,[d]:g}}),onLangSwitch:(d,g)=>{const y=structuredClone(l);y.desc[g]=y.desc[d],delete y.desc[d],h(y)},onRemove:d=>{const g=structuredClone(l);delete g.desc[d],h(g)}})})]}),a(P,{children:[e(z,{size:"sm",onClick:r,children:t("Back to list")}),e(F,{ml:"auto",children:e(z,{size:"sm",colorScheme:"primary",isDisabled:f===""||l.reference===""||l.justification===""||!/^[a-zA-Z0-9. -]+$/.test(l.justification)||Object.keys(l.desc).length>0&&!("en"in l.desc)||p==="",onClick:()=>k(!0),children:t("Submit")})})]}),a(j,{isOpen:u,onClose:()=>k(!1),children:[e(I,{}),a(N,{children:[e(U,{children:t("Submit template")}),e(H,{}),e(B,{children:R.length<100*100?a(te,{children:[e(m,{children:t("You may now copy the following text into your new issue's body.")}),e(Fe,{mt:"2",mb:"4"}),e(We,{ref:o,isReadOnly:!0,defaultValue:R,onClick:({target:d})=>d.select()})]}):a(te,{children:[e(m,{children:t("Upload the file downloaded below at the end of your new issue's body.")}),a(m,{children:[t("Make sure to submit your issue after "),e(Ve,{children:t("Uploading your files... (1/1)")}),t(" is disappeared.")]})]})}),e(ce,{children:R.length<100*100?e(z,{colorScheme:"primary",onClick:q,children:t("Copy issue body and open an issue")}):e(z,{colorScheme:"primary",onClick:T,children:t("Download file")})})]})]})]})}const Pt="/rmp-gallery/assets/github-mark-7a0dd11e.svg",zt="/rmp-gallery/assets/slack-mark-19839006.svg",Et=i=>{const{isOpen:n,onClose:c}=i,{t}=L(),r=S.getAppVersion();return a(j,{isOpen:n,onClose:c,size:"xl",scrollBehavior:"inside",children:[e(I,{}),a(N,{children:[e(U,{children:t("header.about.title")}),e(H,{}),a(B,{paddingBottom:10,children:[a(P,{direction:"row",children:[e($,{boxSize:"128px",src:"/rmp-gallery/logo192.png"}),a(P,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e(m,{fontSize:"xl",as:"b",children:t("header.about.rmpGallery")}),e(m,{children:r}),e(m,{}),e(m,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e(G,{margin:5,children:e(m,{fontSize:"xl",children:t("header.about.desc")})}),e(v,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e(v,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e(D,{children:a(E,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e(M,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),a(O,{display:"block",width:"100%",children:[e(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e(m,{fontSize:"sm",children:t("header.about.content1")}),e(m,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]})}),e(v,{as:"h6",size:"xs",my:2,children:t("header.about.templateAdministrators")}),e(D,{children:["52PD","linchen1965"].map(o=>a(E,{size:"lg",w:"85%",onClick:()=>window.open(`https://github.com/${o}`,"_blank"),cursor:"pointer",children:[e(M,{src:`https://github.com/${o}.png`,size:"lg",my:2,ml:-1,mr:2}),a(O,{display:"block",width:"100%",children:[e(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:o}),e(m,{fontSize:"sm",mb:1,children:t(`header.about.${o}`)})]})]},o))}),e(v,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),a(D,{children:[a(E,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp-gallery/issues","_blank"),cursor:"pointer",children:[e(M,{src:Pt,size:"lg",my:2,ml:-1,mr:2}),a(O,{display:"block",width:"100%",children:[e(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e(m,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),a(E,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e(M,{src:zt,size:"lg",my:2,ml:-1,mr:2}),a(O,{display:"block",width:"100%",children:[e(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e(m,{fontSize:"sm",children:t("header.about.slackContent")}),e(m,{fontSize:"sm",as:"i",children:"#rmg, #rmp, #gallery, #random"})]})]})]})]})]})]})};function Ot(){const{t:i}=L(),n=S.getEnv(),c=S.getAppVersion(),[t,r]=C.useState(!1),o=u=>{S.setLanguage(u),S.getI18nInstance().changeLanguage(u)};return a(Ye,{children:[e(v,{as:"h4",size:"md",children:i("header.about.rmpGallery")}),e(Je,{environment:n,version:c}),a(F,{ml:"auto",children:[a(Ze,{children:[e(Ke,{as:w,icon:e(Qe,{}),variant:"ghost",size:"sm"}),e(Xe,{children:et.map(u=>e(tt,{onClick:()=>o(u),children:x[u][u]},u))})]}),e(w,{size:"sm",variant:"ghost","aria-label":"Help",icon:e(at,{}),onClick:()=>r(!0)})]}),e(Et,{isOpen:t,onClose:()=>r(!1)})]})}function Dt(){return e(nt,{basename:"/rmp-gallery/",children:e(ot,{children:a(rt,{children:[e(Ot,{}),e(ue,{children:a(st,{children:[e(ae,{path:"/",element:e(ne,{children:e(Ct,{})})}),e(ae,{path:"/new",element:e(ne,{children:e(Mt,{})})})]})})]})})})}const Tt={about:{rmpGallery:"RMP Gallery",title:"About",railmapgen:"A railmapgen project",desc:"Browse, set, and submit your RMP template here!",content1:"In memory of all the freedom and equality we once had.",content2:"06/01/2022 in Shanghai",contributors:"Contributors",coreContributors:"Core Contributors",templateAdministrators:"Administrators","52PD":"Special thanks for his continuous effort in maintaining templates.",linchen1965:"Special thanks for his continuous effort in maintaining templates.",contactUs:"Contact Us",github:"Project Repository",githubContent:"Face any problems? Search or raise an issue here!",slack:"Slack Group",slackContent:"Chat in these Slack channels!"}},xt={type:{realWorld:"Real World",fantasy:"Fantasy"}},_t={header:Tt,gallery:xt},jt={about:{rmpGallery:"RMP画廊",title:"About",railmapgen:"一个railmapgen项目",desc:"浏览、设置、提交你制作的RMP模板！",content1:"谨以此纪念我们曾拥有的自由与平等。",content2:"06/01/2022于上海",contributors:"贡献者",coreContributors:"核心贡献者",templateAdministrators:"管理员","52PD":"特别感谢他维护这些模板的持续付出。",linchen1965:"特别感谢他维护这些模板的持续付出。",contactUs:"联系我们",github:"项目仓库",githubContent:"遇到任何问题？在这里搜索或提出一个问题！",slack:"Slack群组",slackContent:"在这些Slack频道中讨论!"}},It={header:jt},Nt={about:{rmpGallery:"RMP畫廊",title:"關於",railmapgen:"一個railmapgen項目",desc:"瀏覽、設置、提交你製作的RMP模板！",content1:"謹以此紀念我們曾擁有的自由與平等。",content2:"06/01/2022於上海",contributors:"貢獻者",coreContributors:"核心貢獻者",templateAdministrators:"管理員","52PD":"特別感謝他維護這些模板的持續付出。",linchen1965:"特別感謝他維護這些模板的持續付出。",contactUs:"聯繫我們",github:"項目倉庫",githubContent:"遇到任何問題？在這裡搜索或提出一個問題！",slack:"Slack群組",slackContent:"在這些Slack頻道中討論!"}},Ut={header:Nt},Ht={about:{rmpGallery:"RMP 갤러리",title:"대함",railmapgen:"railmapgen 프로젝트",desc:"Browse, set, and submit your RMP template here!",content1:"우리가 가졌던 자유와 평등을 기념한다.",content2:"2022년 6월 1일 상해",contributors:"기여자",coreContributors:"핵심 기여자",templateAdministrators:"Administrators","52PD":"Special thanks for his continuous effort in maintaining templates.",linchen1965:"Special thanks for his continuous effort in maintaining templates.",contactUs:"우리에게 연락하기",github:"프로젝트 저장소",githubContent:"무슨 문제라도 있나요? 여기서 문제를 검색하거나 제기하십시오!",slack:"슬랙 그룹",slackContent:"이 슬랙 채널에서 채팅해요!"}},Bt={header:Ht},$t=new S.I18nBuilder().use(it).withAppName("RMP Gallery").withLng(S.getLanguage()).withResource("en",_t).withResource("zh-Hans",It).withResource("zh-Hant",Ut).withResource("ko",Bt).build();let le;const Gt=()=>{le=lt(document.getElementById("root")),le.render(e(ct.StrictMode,{children:e(dt,{store:pe,children:e(ht,{i18n:$t,children:e(Dt,{})})})}))};S.ready().then(()=>{Gt(),S.injectCss(),S.event(W.APP_LOAD,{})});export{Ft as __vite_legacy_guard};
